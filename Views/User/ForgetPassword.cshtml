@{
    ViewData["Title"] = "forgetPassword";
}

<!-- Bootstrap CSS -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<style>
    body {
        background-size: cover;
    }

    .a {
        box-shadow: 0px 0px 20px white;
        transition: 2s all;
    }

        .a:hover {
            transform: scale(1.1);
            transition: 2s all;
            box-shadow: 0px 0px 20px black;
        }
</style>

<body>
    <div class="container-fluid">
        <form method="post" id="form1">
            <div class="row mt-5 mb-5">
                <div class="col-sm-5 mx-auto a">
                    <div class="row">
                        <div class="col-sm-12 text-warning fw-bold fs-3 text-center">
                            Forgot Password
                        </div>
                    </div>

                    <div class="row mt-2 mx-1">
                        <div class="col-sm-12">
                            <span class="text-white">Enter your Email ID</span>
                            <input type="email" class="form-control" name="userid" id="Emailid" placeholder="Enter your email id" />
                        </div>
                        <div class="col-sm-12" id="p1">
                            <span class="text-white">Enter your New Password</span>
                            <input type="password" class="form-control" id="newpass" placeholder="Enter your new password" />
                        </div>
                        <div class="col-sm-12" id="p2">
                            <span class="text-white">Confirm Password</span>
                            <input type="password" class="form-control" id="confirmpass" placeholder="Enter your confirm password" />
                        </div>
                    </div>
                    <div class="row mt-3 mx-1 mb-3">
                        <div class="col-sm-12">
                            <input type="button" class="form-control btn btn-warning" id="btn" value="Verify Email" />
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <script>
        $(document).ready(function () {
            $("#p1").hide();
            $("#p2").hide();

            $('#btn').click(function () {
                var email = $("#Emailid").val();
                var Newpassword = $("#newpass").val();
                var ConfirmPassword = $("#confirmpass").val();

                if (email != "" && Newpassword == "" && ConfirmPassword == "") {
                    $.ajax({
                        url: '/User/VeryfiEmail',
                        type: 'GET',
                        data: { "email": email },
                        success: function (res) {
                            var status = res.status;
                            var message = res.message;
                            alert(message);

                            if (status == 1) {

                                $("#p1").show();
                                $("#p2").show();
                                $("#btn").val("Change Password");
                                $("#Emailid").prop("disabled", true);

                            }
                        },
                        error: function () {
                            alert('Error verifying email.');
                        }
                    });
                } else if (email != "" && Newpassword != "" && ConfirmPassword != "") {
                    if (Newpassword == ConfirmPassword) {
                        $.ajax({
                            url: '/User/changePasswords',
                            type: 'POST',
                            data: { "Email": email, "Password": Newpassword, "Cpassword": ConfirmPassword },
                            success: function (res) {
                               
                                alert(res) ;
                              window.location.href = "/User/Login";
                                 $("#Emailid").val('');
                                $("#newpass").val('');
                               $("#confirmpass").val('');
                                $("#btn").val("Verify Email");
                            },
                            error: function () {
                                alert('Error changing password.');
                            }
                        });
                    } else {
                        $("#confirmpass").css("border", "2px solid red");
                    }
                }
            });

            // Keypress event for password fields
            $("#newpass, #confirmpass").keypress(function (event) {
                var charCode = event.which || event.keyCode;
                var charStr = String.fromCharCode(charCode);

                if (!((charCode >= 48 && charCode <= 57) ||
                    (charCode >= 65 && charCode <= 90) ||
                    (charCode >= 97 && charCode <= 122) ||
                    charCode === 64 ||
                    charCode === 8)) {
                    event.preventDefault();
                }

                var price = $(this).val();
                if (price.length >= 10) {
                    event.preventDefault();
                }
            });
        });
    </script>
</body>
